# Memory Blog 前后端对接完成指南

## ✅ 已完成的工作

### 1. 请求工具适配 ✅

- ✅ 将 Next.js 风格的 request.ts 改为 Vue 3 + Axios 版本
- ✅ 添加请求/响应拦截器
- ✅ 支持自动添加 Token 认证
- ✅ 统一错误处理

文件位置：`src/utils/request.ts`

### 2. API 服务层封装 ✅

- ✅ 90+ 个后端接口全部封装
- ✅ 完整的 TypeScript 类型支持
- ✅ 包括所有模块：
  - 文章管理（15+ 接口）
  - 分类管理（8 接口）
  - 标签管理（7 接口）
  - 用户管理（9 接口）
  - 评论管理（8 接口）
  - 留言管理（9 接口）
  - 说说管理（5 接口）
  - 足迹管理（4 接口）
  - 友链管理（8 接口）
  - 轮播图管理（5 接口）
  - 文件管理（6 接口）
  - 配置管理（6 接口）
  - 数据统计（1 接口）
  - 订阅管理（2 接口）

文件位置：`src/api/index.ts`

### 3. 类型定义更新 ✅

- ✅ Article 类型适配后端结构（cateIds/tagIds 改为数组）
- ✅ 添加 Link 和 LinkType 类型别名
- ✅ 所有类型都正确导出

文件位置：`src/types/app/*.d.ts`

### 4. 示例页面创建 ✅

- ✅ HomeView 组件展示了如何使用 API
- ✅ 包含文章列表、分类、标签、轮播图、作者信息
- ✅ 完整的加载状态和错误处理
- ✅ 响应式设计，美观的 UI

文件位置：`src/views/HomeView.vue`

### 5. 文档完善 ✅

- ✅ 《API使用文档.md》- 详细的 API 使用说明
- ✅ 《快速入门指南.md》（本文件）

## 🚀 快速开始

### 1. 确保后端已启动

确保你的 Spring Boot 后端正在运行：

```bash
# 在后端项目目录
./mvnw spring-boot:run
# 或者
java -jar target/Memory-Server-1.0.0.jar
```

后端应该运行在：`http://localhost:8080`

### 2. 启动前端

```bash
# 安装依赖（如果还没安装）
npm install

# 启动开发服务器
npm run dev
```

前端将运行在：`http://localhost:5173`

### 3. 访问页面

打开浏览器访问：http://localhost:5173

你应该能看到：

- ✅ 顶部导航显示 "Memory Blog"
- ✅ 作者信息卡片（从后端 `/api/user/author` 获取）
- ✅ 文章列表（从后端 `/api/article/paging` 获取）
- ✅ 右侧边栏显示分类、标签
- ✅ 底部显示 API 连接状态

### 4. 查看浏览器控制台

如果看到错误，打开浏览器控制台（F12）检查：

- ❌ 网络错误：检查后端是否启动
- ❌ CORS 错误：需要配置后端 CORS
- ❌ 401 未授权：某些接口需要登录（部分接口是公开的）

## 🔧 环境配置

### 修改后端 API 地址

编辑 `.env` 文件：

```env
# 本地开发
VITE_PROJECT_API=http://localhost:8080/api

# 生产环境（部署后修改为实际地址）
# VITE_PROJECT_API=https://your-domain.com/api
```

## 📖 开发指南

### 在新页面中使用 API

```vue
<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { getArticleDetail } from '@/api'
import type { Article } from '@/types/app/article'

const article = ref<Article | null>(null)
const loading = ref(true)

const fetchArticle = async () => {
  try {
    const { data } = await getArticleDetail(1) // 获取 ID 为 1 的文章
    article.value = data
  } catch (error) {
    console.error('获取文章失败：', error)
  } finally {
    loading.value = false
  }
}

onMounted(() => {
  fetchArticle()
})
</script>

<template>
  <div v-if="loading">加载中...</div>
  <div v-else-if="article">
    <h1>{{ article.title }}</h1>
    <div v-html="article.content"></div>
  </div>
</template>
```

### 使用分页

```typescript
import { getArticleList } from '@/api'

const page = ref(1)
const size = ref(10)
const total = ref(0)

const fetchArticles = async () => {
  const { data } = await getArticleList({
    page: page.value,
    size: size.value,
    isDraft: 0, // 只获取已发布的
    isDel: 0, // 只获取未删除的
  })

  articles.value = data.result
  total.value = data.total
}
```

### 文件上传示例

```vue
<script setup lang="ts">
import { uploadFile } from '@/api'

const handleUpload = async (event: Event) => {
  const files = (event.target as HTMLInputElement).files
  if (!files || files.length === 0) return

  try {
    const { data } = await uploadFile(Array.from(files), 'images')
    console.log('上传成功：', data)
    // data 包含文件 URL 等信息
  } catch (error) {
    console.error('上传失败：', error)
  }
}
</script>

<template>
  <input type="file" @change="handleUpload" multiple />
</template>
```

## 🎯 下一步开发建议

### 1. 创建文章详情页

```bash
src/views/ArticleDetailView.vue
```

使用 `getArticleDetail(id)` 获取文章详情

### 2. 创建分类页面

```bash
src/views/CategoryView.vue
```

使用 `getArticlesByCategory(cateId)` 获取分类下的文章

### 3. 创建标签页面

```bash
src/views/TagView.vue
```

使用 `getArticlesByTag(tagId)` 获取标签下的文章

### 4. 创建评论组件

```bash
src/components/Comment/CommentList.vue
src/components/Comment/CommentForm.vue
```

使用 `getArticleComments()` 和 `createComment()`

### 5. 创建后台管理页面

- 登录页：使用 `userLogin()`
- 文章管理：使用 `createArticle()`, `updateArticle()`, `deleteArticle()`
- 分类管理：使用分类相关接口
- 等等...

### 6. 集成 Pinia Store

参考 `API使用文档.md` 中的 Pinia Store 集成示例，创建状态管理。

## 🐛 常见问题

### 问题 1：CORS 跨域错误

**现象**：浏览器控制台显示 CORS 错误

**解决**：在后端添加 CORS 配置

```java
// 后端 Spring Boot 配置
@Configuration
public class CorsConfig {
    @Bean
    public WebMvcConfigurer corsConfigurer() {
        return new WebMvcConfigurer() {
            @Override
            public void addCorsMappings(CorsRegistry registry) {
                registry.addMapping("/api/**")
                    .allowedOrigins("http://localhost:5173")  // 前端地址
                    .allowedMethods("GET", "POST", "PATCH", "DELETE"," "OPTIONS")
                    .allowedHeaders("*")
                    .allowCredentials(true);
            }
        };
    }
}
```

### 问题 2：401 未授权错误

**现象**：某些接口返回 401

**原因**：这些接口需要管理员权限

**解决**：

1. 先调用登录接口：`userLogin({ username, password })`
2. 将返回的 token 保存到 localStorage
3. 后续请求会自动携带 token

### 问题 3：接口返回空数据

**原因**：后端数据库可能没有数据

**解决**：

1. 在后端创建一些测试数据
2. 或者前端做好空状态处理（已在 HomeView 中处理）

### 问题 4：类型错误

**现象**：TypeScript 报类型错误

**解决**：检查 `src/types/app/*.d.ts` 类型定义是否与后端返回的数据结构一致

## 📚 参考资料

1. **API 使用文档**：`API使用文档.md`
2. **后端 API 文档**：http://localhost:8080/doc.html（Knife4j）
3. **Vue 3 文档**：https://cn.vuejs.org/
4. **Pinia 文档**：https://pinia.vuejs.org/zh/
5. **Axios 文档**：https://axios-http.com/

## ✨ 项目结构

```
memory-blog/
├── src/
│   ├── api/              # API 服务层（已完成）
│   │   └── index.ts      # 所有接口封装
│   ├── types/            # 类型定义（已更新）
│   │   ├── response.d.ts # 响应类型
│   │   └── app/          # 业务类型
│   ├── utils/            # 工具函数
│   │   └── request.ts    # Axios 请求封装（已完成）
│   ├── views/            # 页面组件
│   │   └── HomeView.vue  # 首页示例（已完成）
│   ├── components/       # 公共组件
│   ├── stores/           # Pinia 状态管理
│   └── router/           # 路由配置
├── .env                  # 环境变量配置
├── API使用文档.md        # API 详细文档
└── 快速入门指南.md        # 本文件
```

## 🎉 总结

✅ 前后端对接已完成！
✅ 所有后端接口都已封装好
✅ 提供了完整的类型支持
✅ 创建了示例页面和详细文档

现在你可以：

1. 直接在任何 Vue 组件中导入并使用 API
2. 享受完整的 TypeScript 类型提示
3. 参考 HomeView.vue 和 API使用文档.md 进行开发

祝开发愉快！🚀
